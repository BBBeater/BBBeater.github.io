<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Happy Anniversary - Upgraded Version</title>
<link href="https://fonts.googleapis.com/css2?family=Itim&display=swap" rel="stylesheet" />
<style>
  /* --- Upgraded Styles --- */
  :root {
    --primary-color: #d43f6f;
    --secondary-color: #f48fb1;
    --light-pink-bg: #fff0f5;
    --gradient-start: #ffd6e8;
    --gradient-end: #fff0f5;
    --border-color: #ffb6c1;
    --shadow-color-light: rgba(244,143,177,0.5);
    --shadow-color-dark: #ffb6c1;
    --text-color: #5e2b45;
    --card-bg: #fff0f8;
    --heart-color: #ff8ab8;
  }

  body {
    font-family: 'Itim', cursive;
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    color: var(--text-color);
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    width: 95vw;
    max-width: 600px;
    background: white;
    border-radius: 25px;
    box-shadow: 0 0 25px var(--shadow-color-dark);
    padding: 35px 25px 40px;
    text-align: center;
    box-sizing: border-box;
    position: relative;
    overflow: hidden; /* For page transition */
  }

  /* --- Page Transition --- */
  .page {
    transition: opacity 0.4s ease-in-out;
  }
  .page.hidden {
    display: none;
    opacity: 0;
  }

  h1, h2 {
    color: var(--primary-color);
    margin-bottom: 15px;
  }

  p {
    font-size: 1.2rem;
    margin-bottom: 30px;
    line-height: 1.4;
  }

  input[type="password"], input[type="number"] {
    font-family: 'Itim', cursive;
    font-size: 20px;
    padding: 10px 14px;
    width: 130px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    text-align: center;
    margin-bottom: 15px;
  }

  button {
    background-color: var(--secondary-color);
    border: none;
    color: white;
    font-size: 18px;
    padding: 12px 28px;
    border-radius: 20px;
    cursor: pointer;
    margin: 0 10px;
    transition: background-color 0.3s ease, transform 0.2s ease;
    box-shadow: 0 4px 10px var(--shadow-color-light);
  }

  button:hover {
    background-color: var(--primary-color);
    transform: translateY(-2px);
  }

  .buttons {
    display: flex;
    justify-content: center;
    margin-top: 25px;
    gap: 15px;
  }

  .photo-placeholder {
    width: 100%;
    max-width: 420px;
    height: 320px;
    background: var(--card-bg);
    border: 3px dashed var(--heart-color);
    border-radius: 25px;
    margin: 0 auto 40px;
    box-shadow: 0 0 15px var(--shadow-color-dark);
    line-height: 320px;
    color: var(--heart-color);
    font-size: 1.3rem;
  }

  #error {
    color: var(--primary-color);
    font-weight: bold;
    margin-top: 8px;
  }

  /* Menu grid */
  .menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 20px;
    justify-items: center;
  }
  .menu-card {
    background: var(--card-bg);
    border-radius: 20px;
    box-shadow: 0 0 12px var(--shadow-color-dark);
    cursor: pointer;
    padding: 15px;
    width: 140px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    user-select: none;
  }
  .menu-card.locked {
    cursor: default;
    opacity: 0.6;
  }
  .menu-card:hover:not(.locked) {
    transform: scale(1.07);
    box-shadow: 0 0 20px var(--primary-color);
  }
  .menu-card img {
    width: 80px;
    height: 80px;
    border-radius: 15px;
    margin-bottom: 10px;
    object-fit: cover;
    user-select: none;
  }
  .menu-card .title {
    font-weight: bold;
    color: var(--primary-color);
  }

  #gameMessage, #puzzleMessage {
    font-weight: bold;
    color: var(--primary-color);
    min-height: 28px;
    margin-top: 15px;
    transition: color 0.3s ease;
  }

  /* Back to game menu button */
  .back-game-menu-btn {
    background: #f8bbd0;
    color: #a6265a;
    border-radius: 25px;
    border: none;
    padding: 8px 22px;
    cursor: pointer;
    font-weight: bold;
    margin-bottom: 15px;
    box-shadow: 0 3px 8px rgba(248,187,208,0.6);
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .back-game-menu-btn:hover {
    background: var(--primary-color);
    color: white;
  }

  /* Lightbox overlay */
  #lightboxOverlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(95, 35, 70, 0.9);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #lightboxOverlay img {
    max-width: 90vw;
    max-height: 90vh;
    border-radius: 20px;
    box-shadow: 0 0 25px var(--shadow-color-dark);
    cursor: zoom-out;
    user-select: none;
  }

  /* --- Slideshow --- */
  #slideShow {
    position: relative;
    width: 100%; max-width: 420px; height: 320px;
    margin: 0 auto 20px;
    border-radius: 25px;
    overflow: hidden;
    box-shadow: 0 0 15px var(--shadow-color-dark);
  }
  #slideShow img {
    width: 100%; height: 320px;
    object-fit: cover;
    position: absolute; top: 0; left: 0;
    opacity: 0;
    transition: opacity 0.6s ease;
    border-radius: 25px;
    user-select: none;
  }
  #slideShow img.active {
    opacity: 1;
    position: relative;
  }
  .slide-btn {
    position: absolute; top: 50%;
    transform: translateY(-50%);
    background: rgba(244,143,177,0.9);
    border: none; color: white;
    font-size: 36px;
    padding: 8px 16px;
    border-radius: 50%;
    cursor: pointer; user-select: none;
    transition: background-color 0.3s ease;
    z-index: 10;
  }
  .slide-btn:hover { background: var(--primary-color); }
  #prevBtn { left: 10px; }
  #nextBtn { right: 10px; }

  /* --- Progress bar & counter --- */
  #slideCounter {
    margin: 0 auto 10px;
    font-weight: bold;
    color: var(--primary-color);
  }
  #progressBar {
    width: 100%; max-width: 420px; height: 6px;
    background: #ffe4ef;
    border-radius: 6px;
    margin: 0 auto 30px;
    overflow: hidden;
  }
  #progressBarInner {
    height: 100%; width: 0%;
    background: var(--primary-color);
    border-radius: 6px;
    transition: width 0.4s ease;
  }
  
  /* --- Toast Notification (Upgrade) --- */
  #toast {
    position: fixed;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--primary-color);
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    z-index: 2000;
    font-size: 1.1rem;
    font-weight: bold;
    transition: top 0.5s ease-in-out;
  }
  #toast.show {
    top: 20px;
  }

  /* --- Animations --- */
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-8px); }
    40% { transform: translateX(8px); }
    60% { transform: translateX(-6px); }
    80% { transform: translateX(6px); }
  }
  .shake { animation: shake 0.4s ease; }

  @keyframes flashRed {
    0%, 100% { color: var(--primary-color); }
    50% { color: #ff4d6d; }
  }
  .flashRed { animation: flashRed 0.6s ease; }

  /* Responsive */
  @media (max-width: 480px) {
    .container { padding: 25px 15px 30px; }
    .photo-placeholder, #slideShow, #slideShow img { height: 280px; }
    .menu-card { width: 120px; }
    .menu-card img { width: 70px; height: 70px; }
    input[type="password"], input[type="number"] { width: 100px; font-size: 18px; padding: 8px 12px; }
  }
</style>
</head>
<body>

<div class="container">

  <div id="page0" class="page">
    <h1>üå∏ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üå∏</h1>
    <p>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ üíñ</p>
    <input type="password" id="password" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏£‡∏±‡∏Å..." />
    <br />
    <button onclick="checkPassword()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå</button>
    <p id="error"></p>
  </div>

  <div id="page1" class="page hidden">
    <h1>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ô‡∏∞‡∏∞ üíï</h1>
    <div id="slideShow">
      </div>
    <div id="slideCounter"></div>
    <div id="progressBar"><div id="progressBarInner"></div></div>
    <button id="prevBtn" class="slide-btn" aria-label="Previous Slide">&#10094;</button>
    <button id="nextBtn" class="slide-btn" aria-label="Next Slide">&#10095;</button>
    <div class="buttons">
      <button onclick="showPage('page0')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      <button onclick="showPage('page2')">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
    </div>
  </div>

  <div id="page2" class="page hidden">
    <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏î‡∏π üíå</h2>
    <div class="menu-grid" id="categoryMenu">
      <div class="menu-card" data-category="best">
         <img src="https://via.placeholder.com/80/f7b6cc/fff?text=Best" alt="Best of Month" />
        <div class="title">The Best ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        <small>üîí ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô</small>
      </div>
      <div class="menu-card" data-category="funny">
        <img src="https://via.placeholder.com/80/f7b6cc/fff?text=Funny" alt="Funny" />
        <div class="title">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏Æ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</div>
        <small>üîí ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô</small>
      </div>
      <div class="menu-card" data-category="secret">
        <img src="https://via.placeholder.com/80/f7b6cc/fff?text=Secret" alt="Secret" />
        <div class="title">‡∏£‡∏π‡∏õ‡πÅ‡∏≠‡∏ö‡∏ñ‡πà‡∏≤‡∏¢</div>
        <small>üîí ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô</small>
      </div>
      <div class="menu-card" data-category="love">
        <img src="https://via.placeholder.com/80/f7b6cc/fff?text=Love" alt="Love" />
        <div class="title">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà</div>
        <small>üîí ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô</small>
      </div>
       <div class="menu-card" data-category="letter">
        <img src="https://via.placeholder.com/80/f7b6cc/fff?text=üìú" alt="Letter" />
        <div class="title">‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏•‡∏±‡∏ö</div>
        <small>üîí ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô</small>
      </div>
    </div>
    <div class="buttons">
      <button onclick="showPage('page1')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      <button onclick="showPage('page7')">‡πÑ‡∏õ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ üîì</button>
    </div>
  </div>

  <div id="page3" class="page hidden">
    <h2>The Best ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô üíñ</h2>
    <div class="menu-grid" id="bestGrid"></div>
    <div class="buttons"><button onclick="showPage('page2')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>
  <div id="page4" class="page hidden">
    <h2>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏Æ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ üòÇ</h2>
    <div class="menu-grid" id="funnyGrid"></div>
    <div class="buttons"><button onclick="showPage('page2')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>
  <div id="page5" class="page hidden">
    <h2>‡∏£‡∏π‡∏õ‡πÅ‡∏≠‡∏ö‡∏ñ‡πà‡∏≤‡∏¢ üì∏</h2>
    <div class="menu-grid" id="secretGrid"></div>
    <div class="buttons"><button onclick="showPage('page2')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>
  <div id="page6" class="page hidden">
    <h2>‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡∏≠‡∏ö‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà üíû</h2>
    <div class="menu-grid" id="loveGrid"></div>
    <div class="buttons"><button onclick="showPage('page2')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>
  
  <div id="page8" class.="page hidden">
      <h2>‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏ô‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡πâ‡∏≤ üíå</h2>
      <p style="text-align: left; background: #fff9fb; padding: 20px; border-radius: 15px; border: 1px solid var(--border-color);">
        ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞! ‡πÑ‡∏°‡πà‡∏ô‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏µ‡πâ...<br><br>
        ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏ò‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ ‡∏Ñ‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢ ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏∞ ‡∏£‡∏±‡∏Å‡∏°‡∏≤‡∏Å‡πÜ‡πÄ‡∏•‡∏¢‡∏Ñ‡πâ‡∏≤‡∏ö üíñ
        <br><br>
        ‡∏à‡∏≤‡∏Å... ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡πÄ‡∏ò‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å
      </p>
      <div class="buttons"><button onclick="showPage('page2')">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏°‡∏ô‡∏π</button></div>
  </div>

  <div id="page7" class="page hidden">
    <h2>üéÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ! üéÆ</h2>
    <div class="menu-grid" id="gameMenuGrid">
      <div class="menu-card" data-game="guessNumber"><div class="title">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç üé≤</div></div>
      <div class="menu-card" data-game="cardShuffle"><div class="title">‡πÄ‡∏Å‡∏°‡∏´‡∏≤‡πÑ‡∏û‡πà‡∏´‡∏±‡∏ß‡πÉ‡∏à üÉè</div></div>
      <div class="menu-card" data-game="gachaPull"><div class="title">‡∏Å‡∏≤‡∏ä‡∏≤‡∏î‡∏≤‡∏ß 5 ‚≠ê</div></div>
      <div class="menu-card" data-game="shootHearts"><div class="title">‡∏¢‡∏¥‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏•‡∏á‡∏´‡πà‡∏ß‡∏á üíò</div></div>
    </div>
    <div class="buttons"><button onclick="showPage('page2')">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>

  <div id="gameGuessNumber" class="page hidden">
    <h2>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç (1-10) üé≤</h2>
    <p>‡∏•‡∏≠‡∏á‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏¥!</p>
    <input type="number" id="guessInput" min="1" max="10" />
    <div id="gameMessage"></div>
    <div class="buttons">
      <button onclick="checkGuess()">‡∏ó‡∏≤‡∏¢!</button>
      <button class="back-game-menu-btn" onclick="backToGameMenu('gameGuessNumber')">‡∏Å‡∏•‡∏±‡∏ö</button>
    </div>
  </div>

  <div id="gameCardShuffle" class="page hidden">
    <h2>‡πÄ‡∏Å‡∏°‡∏´‡∏≤‡πÑ‡∏û‡πà‡∏´‡∏±‡∏ß‡πÉ‡∏à üÉè</h2>
    <p>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏û‡πà‡∏´‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÉ‡∏ô 3 ‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠! ‚ô•Ô∏è</p>
    <div id="cardContainer" style="display:flex; justify-content:center; gap:20px; margin: 25px 0;">
      </div>
    <div id="puzzleMessage"></div>
    <div class="buttons">
        <button onclick="startCardGame()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
        <button class="back-game-menu-btn" onclick="backToGameMenu('gameCardShuffle')">‡∏Å‡∏•‡∏±‡∏ö</button>
    </div>
  </div>

  <div id="gameGacha" class="page hidden">
    <h2>‡∏Å‡∏≤‡∏ä‡∏≤‡∏î‡∏≤‡∏ß 5 ‚≠ê</h2>
    <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß! ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ!</p>
    <button onclick="startGacha()">‡∏Å‡∏î‡∏™‡∏∏‡πà‡∏° üé∞</button>
    <div id="gachaResult" style="margin-top: 20px; font-weight: bold; color: var(--primary-color);"></div>
    <div class="buttons"><button class="back-game-menu-btn" onclick="backToGameMenu('gameGacha')">‡∏Å‡∏•‡∏±‡∏ö</button></div>
  </div>

  <div id="gameShootHearts" class="page hidden">
      <h2>‡∏¢‡∏¥‡∏á‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏•‡∏á‡∏´‡πà‡∏ß‡∏á üíò</h2>
      <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏£‡πå‡∏à‡∏û‡∏•‡∏±‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏¢‡∏¥‡∏á!</p>
      <div style="position: relative; margin: 20px auto; width: 320px; height: 280px; background: #ffe4ef; border-radius: 25px; box-shadow: 0 0 15px #ffb6c1;">
        <div id="hoop" style="position: absolute; width: 100px; height: 20px; background: #ff69b4; border-radius: 10px; top: 80px; left: 50%; transform: translateX(-50%);"></div>
        <div id="heart" style="position: absolute; width: 40px; height: 40px; background: red; top: 220px; left: 50%; transform: translateX(-50%); border-radius: 50%; box-shadow: 0 0 10px #ff8ab8;"></div>
      </div>
      <button id="shootBtn">‚ù§Ô∏è ‡∏¢‡∏¥‡∏á!</button>
      <p id="shootMessage" style="margin-top: 18px; font-weight: bold; color: var(--primary-color); min-height: 28px;"></p>
      <div class="buttons">
          <button class="back-game-menu-btn" onclick="backToGameMenu('gameShootHearts')">‡∏Å‡∏•‡∏±‡∏ö</button>
      </div>
  </div>

  <div id="lightboxOverlay">
    <img id="lightboxImage" src="" alt="‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ" />
  </div>
  
  <div id="toast"></div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // --- CONFIGURATION ---
  const CONFIG = {
    password: "0000",
    slides: [
      { src: "https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?auto=format&fit=crop&w=600&q=80", alt: "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°" },
      { src: "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80", alt: "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå" },
      { src: "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?auto=format&fit=crop&w=600&q=80", alt: "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°" },
      { src: "https://images.unsplash.com/photo-1500534623283-312aade485b7?auto=format&fit=crop&w=600&q=80", alt: "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô" },
    ],
    photos: {
      best: ["https://images.unsplash.com/photo-1517816743773-6e0fd518b4a6?auto=format&fit=crop&w=400&q=80", "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=400&q=80", "https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=400&q=80"],
      funny: ["https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?auto=format&fit=crop&w=400&q=80"],
      secret: ["https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=400&q=80"],
      love: ["https://images.unsplash.com/photo-1494790108377-be9c29b29330?auto=format&fit=crop&w=400&q=80"],
    },
    pagePhotoMap: {
        page3: { category: "best", gridId: "bestGrid" },
        page4: { category: "funny", gridId: "funnyGrid" },
        page5: { category: "secret", gridId: "secretGrid" },
        page6: { category: "love", gridId: "loveGrid" },
    }
  };

  // --- STATE MANAGEMENT (localStorage) ---
  let state = {
    currentSlideIndex: 0,
    unlocked: { best: false, funny: false, secret: false, love: false, letter: false },
    guessGame: { targetNumber: null },
    cardGame: { heartIndex: null, cardsPicked: false },
    shootGame: { score: 0, isShooting: false, hoopInterval: null }
  };

  function saveState() {
    localStorage.setItem('anniversaryGameState', JSON.stringify(state.unlocked));
  }

  function loadState() {
    const savedState = localStorage.getItem('anniversaryGameState');
    if (savedState) {
      state.unlocked = JSON.parse(savedState);
    }
  }

  // --- DOM ELEMENTS ---
  const elements = {
    pages: document.querySelectorAll('.page'),
    passwordInput: document.getElementById('password'),
    errorMsg: document.getElementById('error'),
    slideShowContainer: document.getElementById('slideShow'),
    slideCounter: document.getElementById('slideCounter'),
    progressBarInner: document.getElementById('progressBarInner'),
    prevBtn: document.getElementById('prevBtn'),
    nextBtn: document.getElementById('nextBtn'),
    categoryMenu: document.getElementById('categoryMenu'),
    gameMenuGrid: document.getElementById('gameMenuGrid'),
    lightboxOverlay: document.getElementById('lightboxOverlay'),
    lightboxImage: document.getElementById('lightboxImage'),
    toast: document.getElementById('toast'),
    // Game specific
    guessInput: document.getElementById('guessInput'),
    gameMessage: document.getElementById('gameMessage'),
    cardContainer: document.getElementById('cardContainer'),
    puzzleMessage: document.getElementById('puzzleMessage'),
    gachaResult: document.getElementById('gachaResult'),
    shootHeart: document.getElementById('heart'),
    shootHoop: document.getElementById('hoop'),
    shootMessage: document.getElementById('shootMessage'),
    shootBtn: document.getElementById('shootBtn'),
  };

  // --- UI FUNCTIONS ---
  let currentPage = 'page0';

  window.showPage = (id) => {
    const newPage = document.getElementById(id);
    const oldPage = document.getElementById(currentPage);

    if (oldPage && oldPage !== newPage) {
      oldPage.style.opacity = 0;
      setTimeout(() => {
        oldPage.classList.add('hidden');
        if (newPage) {
          newPage.classList.remove('hidden');
          setTimeout(() => newPage.style.opacity = 1, 50); // Small delay for transition
        }
        currentPage = id;
        onPageLoad(id);
      }, 400); // Match CSS transition duration
    } else if (newPage) {
      newPage.classList.remove('hidden');
      setTimeout(() => newPage.style.opacity = 1, 50);
      currentPage = id;
      onPageLoad(id);
    }
  };

  function onPageLoad(id) {
    if (id === 'page1') updateSlideShow();
    if (id === 'page2') updateCategoryLocks();
    if (CONFIG.pagePhotoMap[id]) {
        const { category, gridId } = CONFIG.pagePhotoMap[id];
        loadPhotos(category, gridId);
    }
  }
  
  function showToast(message) {
      elements.toast.textContent = message;
      elements.toast.classList.add('show');
      setTimeout(() => {
          elements.toast.classList.remove('show');
      }, 3000);
  }

  window.checkPassword = () => {
    if (elements.passwordInput.value === CONFIG.password) {
      showPage("page1");
      elements.errorMsg.textContent = "";
    } else {
      elements.errorMsg.textContent = "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞!";
      elements.passwordInput.classList.add('shake');
      setTimeout(() => elements.passwordInput.classList.remove('shake'), 500);
    }
  };

  function loadPhotos(category, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    if (!state.unlocked[category]) {
      container.innerHTML = "<p>üîí ‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!</p>";
      return;
    }
    CONFIG.photos[category].forEach((url, i) => {
      const img = document.createElement("img");
      img.src = url;
      img.alt = `${category} photo ${i+1}`;
      Object.assign(img.style, { borderRadius: "18px", cursor: "pointer", width: "120px", height: "120px", objectFit: "cover", boxShadow: "0 0 15px var(--shadow-color-dark)"});
      img.onclick = () => openLightbox(url);
      container.appendChild(img);
    });
  }

  function updateCategoryLocks() {
    // Check if all main categories are unlocked to unlock the letter
    const allUnlocked = state.unlocked.best && state.unlocked.funny && state.unlocked.secret && state.unlocked.love;
    if(allUnlocked && !state.unlocked.letter) {
        state.unlocked.letter = true;
        saveState();
    }
    
    elements.categoryMenu.querySelectorAll(".menu-card").forEach(card => {
      const cat = card.dataset.category;
      if (state.unlocked[cat]) {
        card.classList.remove("locked");
        card.querySelector("small").textContent = "üîì ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÅ‡∏•‡πâ‡∏ß";
        card.style.opacity = "1";
        card.onclick = () => {
            if (cat === "best") showPage("page3");
            else if (cat === "funny") showPage("page4");
            else if (cat === "secret") showPage("page5");
            else if (cat === "love") showPage("page6");
            else if (cat === "letter") showPage("page8");
        };
      } else {
        card.classList.add("locked");
        card.style.opacity = "0.6";
        card.onclick = null;
      }
    });
  }
  
  function openLightbox(src) {
    elements.lightboxImage.src = src;
    elements.lightboxOverlay.style.display = "flex";
  }

  // --- SLIDESHOW LOGIC ---
  function setupSlideshow() {
      elements.slideShowContainer.innerHTML = CONFIG.slides.map((slide, index) => 
          `<img src="${slide.src}" alt="${slide.alt}" class="${index === 0 ? 'active' : ''}" />`
      ).join('');
      elements.slideImages = elements.slideShowContainer.querySelectorAll('img');
  }

  function updateSlideShow() {
    elements.slideImages.forEach((img, i) => {
      img.classList.toggle("active", i === state.currentSlideIndex);
    });
    const totalSlides = elements.slideImages.length;
    elements.slideCounter.textContent = `‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${state.currentSlideIndex + 1} / ${totalSlides}`;
    elements.progressBarInner.style.width = `${((state.currentSlideIndex + 1) / totalSlides) * 100}%`;
  }
  
  elements.prevBtn.onclick = () => {
    state.currentSlideIndex = (state.currentSlideIndex - 1 + elements.slideImages.length) % elements.slideImages.length;
    updateSlideShow();
  };
  elements.nextBtn.onclick = () => {
    state.currentSlideIndex = (state.currentSlideIndex + 1) % elements.slideImages.length;
    updateSlideShow();
  };

  // --- GAME LOGIC ---
  function unlockCategory(cat, name) {
    if (!state.unlocked[cat]) {
      state.unlocked[cat] = true;
      saveState();
      showToast(`üéâ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏°‡∏ß‡∏î '${name}' ‡πÅ‡∏•‡πâ‡∏ß!`);
      setTimeout(() => showPage("page7"), 500); // Give time to read message
    }
  }

  window.backToGameMenu = (gameId) => {
    if (gameId === 'shootHearts' && state.shootGame.hoopInterval) {
        clearInterval(state.shootGame.hoopInterval);
        state.shootGame.hoopInterval = null;
    }
    showPage('page7');
  }

  // Game 1: Guess Number
  function startGuessNumberGame() {
    state.guessGame.targetNumber = Math.floor(Math.random() * 10) + 1;
    elements.gameMessage.textContent = "";
    elements.guessInput.value = "";
  }
  window.checkGuess = () => {
    const val = parseInt(elements.guessInput.value);
    if (!val || val < 1 || val > 10) {
      elements.gameMessage.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç 1-10 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ô‡∏∞!";
      return;
    }
    if (val === state.guessGame.targetNumber) {
      elements.gameMessage.textContent = "üéâ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
      unlockCategory("best", "The Best");
    } else {
      elements.gameMessage.textContent = `‡∏ú‡∏¥‡∏î‡∏ô‡∏∞! ${val > state.guessGame.targetNumber ? '‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ' : '‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ'}!`;
      elements.guessInput.classList.add("shake");
      elements.gameMessage.classList.add("flashRed");
      setTimeout(() => {
        elements.guessInput.classList.remove("shake");
        elements.gameMessage.classList.remove("flashRed");
      }, 700);
    }
  }

  // Game 2: Card Shuffle
  function setupCardGame() {
    elements.cardContainer.innerHTML = [0,1,2].map(i => 
        `<div class="card" style="width:90px; height:120px; background:#ffe1e9; border-radius:16px; cursor:pointer; box-shadow: 0 0 15px var(--border-color); display:flex; justify-content:center; align-items:center; font-size: 2rem;" onclick="pickCard(${i})">?</div>`
    ).join('');
    elements.cards = elements.cardContainer.querySelectorAll('.card');
  }
  
  window.startCardGame = () => {
    const emojis = ["‚ô•Ô∏è", "üçÄ", "‚≠ê"].sort(() => Math.random() - 0.5);
    state.cardGame.heartIndex = emojis.indexOf("‚ô•Ô∏è");
    state.cardGame.cardsPicked = false;
    elements.puzzleMessage.textContent = "‡∏´‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≠‡∏ô‡∏∞!";
    elements.cards.forEach((card, i) => {
        card.textContent = "?";
        card.dataset.emoji = emojis[i];
        card.classList.remove('shake');
        card.style.background = "#ffe1e9";
        card.style.color = 'var(--text-color)';
        card.style.pointerEvents = 'auto';
    });
  }

  window.pickCard = (i) => {
    if (state.cardGame.cardsPicked) return;
    state.cardGame.cardsPicked = true;
    
    elements.cards.forEach((card, idx) => {
        card.textContent = card.dataset.emoji;
        card.style.pointerEvents = 'none';
        if(card.dataset.emoji === "‚ô•Ô∏è") {
            card.style.background = 'var(--primary-color)';
            card.style.color = 'white';
        }
    });

    if (i === state.cardGame.heartIndex) {
      elements.puzzleMessage.textContent = "üéâ ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡πÄ‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß!";
      unlockCategory("funny", "‡∏£‡∏π‡∏õ‡∏Æ‡∏≤");
    } else {
      elements.puzzleMessage.textContent = "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ô‡πâ‡∏≤~ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞ üí¶";
      elements.cards[i].classList.add("shake");
      elements.puzzleMessage.classList.add("flashRed");
      setTimeout(() => elements.puzzleMessage.classList.remove("flashRed"), 600);
    }
  }
  
  // Game 3: Gacha
  window.startGacha = () => {
    elements.gachaResult.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏∏‡πà‡∏°... üé∞";
    const emojis = ["‚≠ê", "üåü", "üí´", "‚ú®", "üå∏", "‚ù§Ô∏è", "üçÄ"];
    let spinCount = 0;
    const spinInterval = setInterval(() => {
      elements.gachaResult.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      if (++spinCount >= 15) {
        clearInterval(spinInterval);
        const stars = Math.floor(Math.random() * 5) + 1;
        elements.gachaResult.textContent = `‡πÑ‡∏î‡πâ ${stars} ‡∏î‡∏≤‡∏ß! ${"‚≠ê".repeat(stars)}`;
        if (stars === 5) {
          elements.gachaResult.textContent += " üéâ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î!";
          unlockCategory("secret", "‡∏£‡∏π‡∏õ‡πÅ‡∏≠‡∏ö‡∏ñ‡πà‡∏≤‡∏¢");
        }
      }
    }, 120);
  }

  // Game 4: Shoot Hearts
  function startShootHeartGame() {
      state.shootGame.score = 0;
      state.shootGame.isShooting = false;
      elements.shootHeart.style.top = "220px";
      elements.shootMessage.textContent = `‡∏¢‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏á 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á! (0/3)`;

      let hoopDirection = 1;
      if (state.shootGame.hoopInterval) clearInterval(state.shootGame.hoopInterval);
      state.shootGame.hoopInterval = setInterval(() => {
        let left = parseFloat(elements.shootHoop.style.left) || 160;
        left += hoopDirection * 2;
        if (left > 220 || left < 100) hoopDirection *= -1;
        elements.shootHoop.style.left = `${left}px`;
      }, 30);
  }

  function shootHeart(power) {
      if (state.shootGame.isShooting) return;
      state.shootGame.isShooting = true;
      let velocityY = -power;
      let posY = parseFloat(elements.shootHeart.style.top);
      
      function animate() {
          posY += velocityY;
          velocityY += 0.3; // Gravity
          elements.shootHeart.style.top = `${posY}px`;

          const heartRect = elements.shootHeart.getBoundingClientRect();
          const hoopRect = elements.shootHoop.getBoundingClientRect();
          
          if (heartRect.top > hoopRect.top && heartRect.bottom < hoopRect.bottom + 20 && heartRect.left > hoopRect.left && heartRect.right < hoopRect.right) {
              state.shootGame.score++;
              elements.shootMessage.textContent = `‚úÖ ‡∏•‡∏á‡∏´‡πà‡∏ß‡∏á‡πÅ‡∏•‡πâ‡∏ß! (${state.shootGame.score}/3)`;
              if (state.shootGame.score >= 3) {
                  unlockCategory("love", "‡∏£‡∏π‡∏õ‡∏Ñ‡∏π‡πà");
                  elements.shootMessage.textContent += " ‚ù§Ô∏è ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!";
              }
              resetHeart();
              return;
          }

          if (posY > 300) {
              elements.shootMessage.textContent = "‚ùå ‡∏û‡∏•‡∏≤‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞";
              resetHeart();
              return;
          }
          requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
  }
  
  function resetHeart() {
      setTimeout(() => {
          elements.shootHeart.style.transition = 'none';
          elements.shootHeart.style.top = "220px";
          state.shootGame.isShooting = false;
      }, 500);
  }
  
  let chargeStartTime = 0;
  elements.shootBtn.onmousedown = elements.shootBtn.ontouchstart = (e) => {
    e.preventDefault();
    if(state.shootGame.isShooting) return;
    chargeStartTime = Date.now();
    elements.shootBtn.style.transform = 'scale(1.1)';
  };
  elements.shootBtn.onmouseup = elements.shootBtn.ontouchend = (e) => {
    e.preventDefault();
    if(chargeStartTime === 0) return;
    const holdTime = Date.now() - chargeStartTime;
    const power = Math.min(Math.max(holdTime / 80, 5), 12); // clamp power
    shootHeart(power);
    chargeStartTime = 0;
    elements.shootBtn.style.transform = 'scale(1)';
  };

  // --- INITIALIZATION ---
  function init() {
    loadState();
    setupSlideshow();
    setupCardGame();

    // Event listeners
    elements.lightboxOverlay.onclick = () => elements.lightboxOverlay.style.display = "none";
    
    elements.gameMenuGrid.querySelectorAll(".menu-card").forEach(card => {
      card.onclick = () => {
        const game = card.dataset.game;
        if (game === "guessNumber") { startGuessNumberGame(); showPage("gameGuessNumber"); }
        else if (game === "cardShuffle") { startCardGame(); showPage("gameCardShuffle"); }
        else if (game === "gachaPull") showPage("gameGacha");
        else if (game === "shootHearts") { startShootHeartGame(); showPage("gameShootHearts"); }
      };
    });

    // Make functions globally accessible for inline onclick handlers
    // This is a simple approach for this single-file project.
    window.openLightbox = openLightbox;

    // Start on the password page
    showPage('page0');
    document.getElementById('page0').style.opacity = 1;
  }

  init();

});
</script>
</body>
</html>
